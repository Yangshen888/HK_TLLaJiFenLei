(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/clockin/PMZZY"],{"6a6d":function(t,e,i){"use strict";i.r(e);var n=i("e5a4"),o=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},"96e0":function(t,e,i){"use strict";(function(t){i("f397"),i("921b");n(i("66fd"));var e=n(i("b733"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},a25d:function(t,e,i){"use strict";var n,o=function(){var t=this,e=t.$createElement,i=(t._self._c,t.amSign.time.substring(10,16)),n=t.pmSign.time.substring(10,16);t.$mp.data=Object.assign({},{$root:{g0:i,g1:n}})},a=[];i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}))},b733:function(t,e,i){"use strict";i.r(e);var n=i("a25d"),o=i("6a6d");for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i("eb4e");var s,l=i("f0c5"),d=Object(l["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=d.exports},d3ee:function(t,e,i){},e5a4:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i("1b54"),o=i("d51b"),a=i("5734"),s=i("c01b"),l=i("4eb6"),d=i("9ddd"),r=function(){i.e("components/uni-icon/uni-icon").then(function(){return resolve(i("336b"))}.bind(null,i)).catch(i.oe)},u={components:{uniIcon:r},data:function(){return{outmap:{markers:[],circles:[{latitude:29.79317,longitude:119.6915,fillColor:"#999999AA",color:"#cacacaAA",radius:20,strokeWidth:2}],scale:18,latitude:29.79317,longitude:119.6915},name:"我的名字",bzText:{time:"",address:"",img:"",remarks:""},type:"",picker_room:[],index:0,trashroom:"",r:80,Timer:[{time:"09:00"},{time:"18:00"}],isAm:!1,isPm:!1,amSign:{time:"",address:"",remarks:"",img:""},pmSign:{time:"",address:"",remarks:"",img:""},signModel:{AmstartTime:"",AmstartPlace:"",AmendTime:"",AmendPlace:"",PmstartTime:"",PmstartPlace:"",PmendTime:"",PmendPlace:"",UserUUID:"",UserName:"",Type:"",garbageRoomUuid:"",TimeState:"pm"},clickNum:0,is:!0,isSign:!1,time:(0,n.formateDate)(new Date,"h:min:s"),date:(0,n.formateDate)(new Date,"Y-M-D"),latitude:"",longitude:"",address:"我的位置",wqInfo:null,allSign:[],signInfo:{mode:"",latitude:"",longitude:"",address:"",time:"",remarks:""},covers:[{id:0,callout:{content:"*****科技有限公司",color:"red",display:"ALWAYS"},latitude:37.788338,longitude:112.557031,iconPath:"../../../static/img/location.png"}],circles:[{latitude:37.788338,longitude:112.557031,radius:80,strokeWidth:1,fillColor:"#7fff0099"}],volunteerlist:{picker:[{volunteerId:"",name:""}],index:0}}},onLoad:function(){var t=(0,o.getSignInfo)(3);if(console.log(t),void 0!=t){var e=t.main.reverse();this.allSign=e,1==e.length?(0,n.isSameDay)(e[0].nowT)&&(this.isSign=!0,this.isAm=!0,this.allSign=e,this.amSign=e[0]):(e[0]&&(0,n.isSameDay)(e[0].nowT)&&(this.isSign=!0,this.isPm=!0,this.allSign=e,this.pmSign=e[0]),e[1]&&(0,n.isSameDay)(e[1].nowT)&&(this.isSign=!0,this.isAm=!0,this.allSign=e,this.amSign=e[1]))}this.getTime(),this.doTrashRoomList()},methods:{togglePopup:function(t){this.type=t},GetXFPosition:function(){var t=this;(0,d.getXFsList)().then((function(e){t.outmap.markers=e.data.data}))},getvolunteerlist:function(){var t=this;(0,s.getalllist)().then((function(e){200==e.data.code&&(console.log(e.data.data),t.volunteerlist.picker=e.data.data)}))},doTrashRoomList:function(){var e=this,i=this.outmap.longitude+","+this.outmap.latitude;t.getLocation({type:"gcj02",altitude:!0,success:function(t){i=t.longitude+","+t.latitude,console.log(i),(0,l.getTrashRoomList)(i).then((function(t){console.log(t),200==t.data.code&&(e.picker_room=t.data.data,e.trashroom=e.picker_room[e.index].garbageRoomUuid,e.gettrashlocation(),e.getLocation())})),e.outmap.latitude=t.latitude,e.outmap.longitude=t.longitude,e.outmap.circles[0].latitude=t.latitude,e.outmap.circles[0].longitude=t.longitude}})},volunteerChange:function(t){this.volunteerlist.index=t.target.value,console.log(this.volunteerlist.picker[this.volunteerlist.index].realName)},getAdd:function(){if(!this.isAm||!this.isPm){if(!0===this.is){var e=this.covers[0].callout.content;return this.address=e,void(this.signInfo.address=e)}var i=this,a="https://apis.map.qq.com/ws/geocoder/v1/?location=".concat(i.latitude,",").concat(i.longitude,"&key=").concat(o.key);t.request({url:a,success:function(e){var o=e.data;if(0==o.status){i.latitude=o.result.ad_info.location.lat,i.longitude=o.result.ad_info.location.lng,i.covers[0]={id:1,latitude:i.latitude,longitude:i.longitude,iconPath:"../../static/location.png"};var a=(0,n.pointInsideCircle)([i.latitude,i.longitude],[i.covers[0].latitude,i.covers[0].longitude],i.r/1e5);if(console.log(a),console.log(i.latitude),console.log(i.longitude),i.is=a,i.signInfo.latitude=e.latitude,i.signInfo.longitude=e.longitude,i.signInfo.mode="正常打卡",i.signInfo.address=e.data.result.address+e.data.result.formatted_addresses.recommend,null===i.is&&(i.address="请检查位置信息！"),!1===i.is){var s=e.data.result.address+e.data.result.formatted_addresses.recommend;i.address=s,i.signInfo.address=s}}else t.showToast({title:o.message,icon:"none"})}})}},bindDateChange:function(t){this.date=t.target.value},reset:function(){var e=this;t.showModal({title:"重置本地打卡信息",content:"您确定要重置打卡信息吗？点击确定本地打卡信息会被清除！",success:function(t){if(t.confirm)(0,o.delSignInfo)(1),e.isSign=!1,e.isAm=!1,e.isPm=!1,e.allSign=[];else if(t.cancel)return}})},openMap:function(e){console.log(e);var i=this.outmap.markers.find((function(t){return t.id==e.markerId})),n=i.latitude,o=i.longitude,a=i.title;t.openLocation({latitude:n,longitude:o,name:a,success:function(){console.log("success")},fail:function(){console.log("error")}})},getTime:function(){var t=this;setInterval((function(){t.time=(0,n.formateDate)(new Date,"h:min:s")}),1e3)},getLocation:function(){var e=this;t.getLocation({type:"gcj02 ",success:function(i){t.hideLoading(),e.latitude=i.latitude,e.longitude=i.longitude,e.getAdd()},fail:function(i){t.hideLoading(),e.address="请检查位置信息！",t.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})}})},clickSign:function(){var e=this,i=this.is;if(null!==i){t.showLoading({title:"打卡记录中...",mask:!0}),this.signInfo.time=(0,n.formateDate)(new Date,"Y-M-D h:min:s");var s=(0,o.getSignInfo)(3);void 0!=s?(0,o.addSignInfo)((0,o.getInfo)(this.signInfo),s,3):(0,o.setSignInfo)((0,o.getInfo)(this.signInfo),3),t.hideLoading();var l=(0,o.getSignInfo)(3).main;e.allSign=l.reverse(),e.isSign=!0,this.trashroom=this.picker_room[this.index].garbageRoomUuid,!1===e.isAm?(e.isAm=!0,e.amSign=e.allSign[0],e.signModel.PmstartTime=e.amSign.time,e.signModel.PmstartPlace=e.amSign.address,e.signModel.UserUUID=e.$store.state.userId,e.signModel.UserName=e.$store.state.userName,e.signModel.Type="1",e.signModel.garbageRoomUuid=this.trashroom,console.log(e.signModel),(0,a.doClockIn)(e.signModel).then((function(e){console.log(e),200==e.data.code?t.showToast({title:"打卡成功！"}):t.showToast({title:e.message})}))):(e.isPm=!0,e.pmSign=e.allSign[1],e.signModel.PmendTime=e.pmSign.time,e.signModel.PmendPlace=e.signInfo.address,(0,a.doClockBack)(e.signModel).then((function(e){200==e.data.code?t.showToast({title:"打卡成功！"}):t.showToast({title:e.message})})))}else t.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})},openLocation:function(){var e=this;t.chooseLocation({success:function(t){e.address=t.address,e.signInfo.address=t.address,e.signInfo.latitude=t.latitude,e.signInfo.longitude=t.longitude,e.latitude=t.latitude,e.longitude=t.longitude;var i=(0,n.pointInsideCircle)([e.latitude,e.longitude],[e.circles[0].latitude,e.circles[0].longitude],e.r/1e4);console.log(e.latitude+"---"+e.longitude),console.log(t),e.is=i}})},gettrashlocation:function(){var t=this;(0,l.doGetTrashLocation)(this.trashroom).then((function(e){if(200==e.data.code){var i=e.data.data;console.log(i),t.covers[0].callout.content=i.ljname,t.covers[0].latitude=t.circles[0].latitude=i.lat,t.covers[0].longitude=t.circles[0].longitude=i.lon}}))},PickerChange:function(t){console.log(t.detail.value),this.index=t.detail.value,this.trashroom=this.picker_room[this.index].garbageRoomUuid,this.gettrashlocation()}},mounted:function(){this.GetXFPosition()}};e.default=u}).call(this,i("543d")["default"])},eb4e:function(t,e,i){"use strict";var n=i("d3ee"),o=i.n(n);o.a}},[["96e0","common/runtime","common/vendor"]]]);