(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/clockin/PMDDY"],{"39e0":function(t,e,i){"use strict";i.r(e);var o=i("b870"),n=i.n(o);for(var s in o)"default"!==s&&function(t){i.d(e,t,(function(){return o[t]}))}(s);e["default"]=n.a},"42e8":function(t,e,i){},"798d":function(t,e,i){"use strict";i.r(e);var o=i("aeb6"),n=i("39e0");for(var s in n)"default"!==s&&function(t){i.d(e,t,(function(){return n[t]}))}(s);i("f228");var a,l=i("f0c5"),d=Object(l["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);e["default"]=d.exports},aeb6:function(t,e,i){"use strict";var o,n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.amSign.time.substring(10,16)),o=t.pmSign.time.substring(10,16);t.$mp.data=Object.assign({},{$root:{g0:i,g1:o}})},s=[];i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return o}))},b870:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i("1b54"),n=i("d51b"),s=i("5734"),a=i("4eb6"),l=i("9ddd"),d={data:function(){return{showMess:"",messageInfo:"",outmap:{markers:[],circles:[{latitude:29.79317,longitude:119.6915,fillColor:"#999999AA",color:"#cacacaAA",radius:10,strokeWidth:2}],scale:18,latitude:29.79317,longitude:119.6915},name:"我的名字",bzText:{time:"",address:"",img:"",remarks:""},type:"",picker_room:[],index:0,trashroom:"",r:80,Timer:[{time:"09:00"},{time:"18:00"}],isAm:!1,isPm:!1,amSign:{time:"",address:"",remarks:"",img:""},pmSign:{time:"",address:"",remarks:"",img:""},signModel:{AmstartTime:"",AmstartPlace:"",AmendTime:"",AmendPlace:"",PmstartTime:"",PmstartPlace:"",PmendTime:"",PmendPlace:"",UserUUID:"",UserName:"",Type:"",garbageRoomUuid:"",TimeState:"pm"},clickNum:0,is:!0,isSign:!1,time:(0,o.formateDate)(new Date,"h:min:s"),date:(0,o.formateDate)(new Date,"Y-M-D"),latitude:"",longitude:"",address:"我的位置",wqInfo:null,allSign:[],signInfo:{mode:"",latitude:"",longitude:"",address:"",time:"",remarks:""},covers:[{id:0,callout:{content:"*****科技有限公司",color:"red",display:"ALWAYS"},latitude:37.788338,longitude:112.557031,iconPath:"../../../static/img/location.png"}],circles:[{latitude:37.788338,longitude:112.557031,radius:80,strokeWidth:1,fillColor:"#7fff0099"}]}},onLoad:function(){var t=(0,n.getSignInfo)(2);if(console.log(t),void 0!=t){var e=t.main.reverse();this.allSign=e,1==e.length?(0,o.isSameDay)(e[0].nowT)&&(this.isSign=!0,this.isAm=!0,this.allSign=e,this.amSign=e[0]):(e[0]&&(0,o.isSameDay)(e[0].nowT)&&(this.isSign=!0,this.isPm=!0,this.allSign=e,this.pmSign=e[0]),e[1]&&(0,o.isSameDay)(e[1].nowT)&&(this.isSign=!0,this.isAm=!0,this.allSign=e,this.amSign=e[1]))}this.getTime(),this.doTrashRoomList()},methods:{togglePopup:function(t){this.type=t},GetXFPosition:function(){var t=this;(0,l.getXFsList)().then((function(e){t.outmap.markers=e.data.data,console.log(t.outmap.markers)}))},doTrashRoomList:function(){var e=this,i=this.outmap.longitude+","+this.outmap.latitude;t.getLocation({type:"gcj02",altitude:!0,success:function(t){i=t.longitude+","+t.latitude,console.log(i),(0,a.getTrashRoomList)(i).then((function(t){console.log(t),200==t.data.code&&(e.picker_room=t.data.data,e.trashroom=e.picker_room[e.index].garbageRoomUuid,e.gettrashlocation(),e.getLocation())})),e.outmap.latitude=t.latitude,e.outmap.longitude=t.longitude,e.outmap.circles[0].latitude=t.latitude,e.outmap.circles[0].longitude=t.longitude}})},openMap:function(e){var i=this.outmap.markers.find((function(t){return t.id==e.markerId})),o=i.latitude,n=i.longitude,s=i.title;console.log(this.getDistance(o,n,this.outmap.latitude,this.outmap.longitude)),t.openLocation({latitude:o,longitude:n,name:s,success:function(){console.log("success")},fail:function(){console.log("error")}})},getAdd:function(){if(!this.isAm||!this.isPm){if(!0===this.is){var e=this.covers[0].callout.content;return this.address=e,void(this.signInfo.address=e)}var i=this,s="https://apis.map.qq.com/ws/geocoder/v1/?location=".concat(i.latitude,",").concat(i.longitude,"&key=").concat(n.key);console.log(s),t.request({url:s,success:function(e){console.info(e.data);var n=e.data;if(0==n.status){console.log(n),i.latitude=n.result.ad_info.location.lat,i.longitude=n.result.ad_info.location.lng,i.covers[0]={id:1,latitude:i.latitude,longitude:i.longitude,iconPath:"../../static/location.png"};var s=(0,o.pointInsideCircle)([i.latitude,i.longitude],[i.covers[0].latitude,i.covers[0].longitude],i.r/1e5);if(console.log(s),console.log(i.latitude),console.log(i.longitude),i.is=s,i.signInfo.latitude=e.latitude,i.signInfo.longitude=e.longitude,i.signInfo.mode="正常打卡",i.signInfo.address=e.data.result.address+e.data.result.formatted_addresses.recommend,null===i.is&&(i.address="请检查位置信息！"),!1===i.is){var a=e.data.result.address+e.data.result.formatted_addresses.recommend;i.address=a,i.signInfo.address=a}}else t.showToast({title:n.message,icon:"none"})}})}},PickerChange:function(t){console.log(t.detail.value),this.index=t.detail.value,this.trashroom=this.picker_room[this.index].garbageRoomUuid,this.gettrashlocation()},bindDateChange:function(t){this.date=t.target.value},reset:function(){var t=this;(0,n.delSignInfo)(2),t.isSign=!1,t.isAm=!1,t.isPm=!1,t.allSign=[]},getTime:function(){var t=this;setInterval((function(){t.time=(0,o.formateDate)(new Date,"h:min:s")}),1e3)},getLocation:function(){var e=this;t.getLocation({type:"gcj02 ",success:function(i){t.hideLoading(),e.latitude=i.latitude,e.longitude=i.longitude,e.getAdd()},fail:function(i){t.hideLoading(),e.address="请检查位置信息！",t.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})}})},clickSign:function(){var e=this,i=this,a=this.is;if(null!==a){t.showLoading({title:"打卡记录中...",mask:!0}),this.signInfo.time=(0,o.formateDate)(new Date,"Y-M-D h:min:s");var l=(0,n.getSignInfo)(2);void 0!=l?(0,n.addSignInfo)((0,n.getInfo)(this.signInfo),l,2):(0,n.setSignInfo)((0,n.getInfo)(this.signInfo),2),t.hideLoading();var d=(0,n.getSignInfo)(2).main;i.allSign=d.reverse(),i.isSign=!0,this.trashroom=this.picker_room[this.index].garbageRoomUuid,!1===i.isAm?(i.isAm=!0,i.amSign=i.allSign[0],i.signModel.PmstartTime=i.amSign.time,i.signModel.PmstartPlace=i.amSign.address,i.signModel.UserUUID=i.$store.state.userId,i.signModel.UserName=i.$store.state.userName,i.signModel.Type="0",i.signModel.garbageRoomUuid=this.trashroom,console.log(i.signModel),(0,s.doClockIn)(i.signModel).then((function(i){200==i.data.code?(t.showToast({title:"打卡成功！"}),e.showMessage()):t.showToast({title:i.message})}))):(i.isPm=!0,i.pmSign=i.allSign[1],i.signModel.PmendTime=i.pmSign.time,i.signModel.PmendPlace=i.pmSign.address,(0,s.doClockBack)(i.signModel).then((function(e){200==e.data.code?t.showToast({title:"打卡成功！"}):t.showToast({title:e.message})}))),console.log(this.is)}else t.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})},openLocation:function(){var e=this;t.chooseLocation({success:function(t){e.address=t.address,e.signInfo.address=t.address,e.signInfo.latitude=t.latitude,e.signInfo.longitude=t.longitude,e.latitude=t.latitude,e.longitude=t.longitude;var i=(0,o.pointInsideCircle)([e.latitude,e.longitude],[e.circles[0].latitude,e.circles[0].longitude],e.r/1e4);console.log(i),e.is=i}})},showMessage:function(){var t=this;console.log(11111111),console.log(this.$store.state),console.log(this.$store.state.userId),(0,s.message)({guid:this.$store.state.userId}).then((function(e){if(200==e.data.code){console.log(11111111),console.log(e.data.data);var i=e.data.data;if(null!=i&&i.length>0){t.showMess="show";for(var o=0;o<i.length;o++)t.messageInfo.length>0&&(t.messageInfo+=","),t.messageInfo+=i[o].realName;t.messageInfo+="志愿者今天与您一起值班"}}}))},gettrashlocation:function(){var t=this;(0,a.doGetTrashLocation)(this.trashroom).then((function(e){if(200==e.data.code){var i=e.data.data;console.log(i),t.covers[0].callout.content=i.ljname,t.covers[0].latitude=t.circles[0].latitude=i.lat,t.covers[0].longitude=t.circles[0].longitude=i.lon}}))},getDistance:function(t,e,i,o){var n=t*Math.PI/180,s=i*Math.PI/180,a=n-s,l=e*Math.PI/180-o*Math.PI/180,d=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(n)*Math.cos(s)*Math.pow(Math.sin(l/2),2)));return d*=6378.137,d=Math.round(1e4*d)/1e4,d}},mounted:function(){this.GetXFPosition()}};e.default=d}).call(this,i("543d")["default"])},df6c:function(t,e,i){"use strict";(function(t){i("f397"),i("921b");o(i("66fd"));var e=o(i("798d"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},f228:function(t,e,i){"use strict";var o=i("42e8"),n=i.n(o);n.a}},[["df6c","common/runtime","common/vendor"]]]);